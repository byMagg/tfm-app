---
import { LoginForm } from '@/components/LoginForm'
import { SignoutButton } from '@/components/SignoutButton'
import Layout from '@/layouts/Layout.astro'
import { app } from '@/lib/firebase/serverrver'
import { getAuth } from 'firebase-admin/auth'

let showLogin = true

/* Check if the user is authenticated */
const auth = getAuth(app)

if (Astro.cookies.has('__session')) {
  const sessionCookie = Astro.cookies.get('__session')?.value

  if (!sessionCookie) {
    showLogin = true
    return
  }

  const decodedCookie = await auth.verifySessionCookie(sessionCookie)
  if (decodedCookie) {
    showLogin = false
  }
}
---

<Layout title="Login">
  {showLogin ? <LoginForm client:load /> : <SignoutButton client:load />}
</Layout>
